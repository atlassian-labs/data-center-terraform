name: Automated Testing
on:
  workflow_dispatch:
  push:
    branches:
      - main
  pull_request:

jobs:
  test:
    name: Automated Testing
    runs-on: ubuntu-latest
    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#      AWS_DEFAULT_REGION: ${{ secrets.AWS_DEFAULT_REGION }}

    steps:
      - name: Checkout
        uses: actions/checkout@v1
#        with:
#          fetch-depth: 1
      - name: Setup Go environment
        uses: actions/setup-go@v2.1.4
        with:
          # The Go version to download (if necessary) and use. Supports semver spec and ranges.
          go-version: 1.17
#          # Whether to download only stable versions
#          stable: # optional, default is true
#          # Used to pull node distributions from go-versions.  Since there's a default, this is typically not supplied by the user.
#          token: # optional, default is ${{ github.token }}
      - name: Setup dependencies
        working-directory: test/
        run: go get -v -t -d ./... && go mod tidy
      - name: Unit tests
        working-directory: test/
        run: go test ./unittest/... -v