<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../../assets/logos/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-8.2.16"><title>Common configuration - Deployment Automation for Atlassian DC on Kubernetes</title><link rel=stylesheet href=../../../assets/stylesheets/main.1c3799f8.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cc9b2e1e.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9EV9WQVD44"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-9EV9WQVD44",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9EV9WQVD44"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#common-configuration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes title="Share your feedback with the Atlassian Data Center on Kubernetes Community" style=color:white><strong>Share your feedback and join the discussion</strong></a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Deployment Automation for Atlassian DC on Kubernetes" class="md-header__button md-logo" aria-label="Deployment Automation for Atlassian DC on Kubernetes" data-md-component=logo> <img src=../../../assets/logos/atlassian-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Deployment Automation for Atlassian DC on Kubernetes </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Common configuration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/atlassian-labs/data-center-terraform title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian-labs/data-center-terraform </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../PREREQUISITES/ class="md-tabs__link md-tabs__link--active"> User guide </a> </li> <li class=md-tabs__item> <a href=../../../troubleshooting/TROUBLESHOOTING/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../../development/HOW_TO_START/ class=md-tabs__link> Development </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Deployment Automation for Atlassian DC on Kubernetes" class="md-nav__button md-logo" aria-label="Deployment Automation for Atlassian DC on Kubernetes" data-md-component=logo> <img src=../../../assets/logos/atlassian-logo.svg alt=logo> </a> Deployment Automation for Atlassian DC on Kubernetes </label> <div class=md-nav__source> <a href=https://github.com/atlassian-labs/data-center-terraform title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian-labs/data-center-terraform </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> User guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User guide" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../PREREQUISITES/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../INSTALLATION/ class=md-nav__link> Installation </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3> Configuration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Configuration data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Common configuration <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Common configuration </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#common-configuration_1 class=md-nav__link> Common Configuration </a> <nav class=md-nav aria-label="Common Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environment-name class=md-nav__link> Environment Name </a> </li> <li class=md-nav__item> <a href=#eks-k8s-api-version class=md-nav__link> EKS K8S API version </a> </li> <li class=md-nav__item> <a href=#region class=md-nav__link> Region </a> </li> <li class=md-nav__item> <a href=#products class=md-nav__link> Products </a> </li> <li class=md-nav__item> <a href=#whitelist-ip-blocks class=md-nav__link> Whitelist IP blocks </a> </li> <li class=md-nav__item> <a href=#domain class=md-nav__link> Domain </a> </li> <li class=md-nav__item> <a href=#resource-tags class=md-nav__link> Resource tags </a> </li> <li class=md-nav__item> <a href=#eks-instance-type-and-storage-size class=md-nav__link> EKS instance type and storage size </a> </li> <li class=md-nav__item> <a href=#eks-node-launch-template class=md-nav__link> EKS Node Launch Template </a> </li> <li class=md-nav__item> <a href=#cluster-size class=md-nav__link> Cluster size </a> </li> <li class=md-nav__item> <a href=#additional-iam-roles class=md-nav__link> Additional IAM roles </a> </li> <li class=md-nav__item> <a href=#logging-s3-bucket-name class=md-nav__link> Logging S3 bucket name </a> </li> <li class=md-nav__item> <a href=#monitoring class=md-nav__link> Monitoring </a> </li> <li class=md-nav__item> <a href=#snapshot-configuration class=md-nav__link> Snapshot Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#product-specific-configuration class=md-nav__link> Product specific configuration </a> </li> <li class=md-nav__item> <a href=#sensitive-data class=md-nav__link> Sensitive Data </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../BAMBOO_CONFIGURATION/ class=md-nav__link> Bamboo configuration </a> </li> <li class=md-nav__item> <a href=../BITBUCKET_CONFIGURATION/ class=md-nav__link> Bitbucket configuration </a> </li> <li class=md-nav__item> <a href=../CONFLUENCE_CONFIGURATION/ class=md-nav__link> Confluence configuration </a> </li> <li class=md-nav__item> <a href=../JIRA_CONFIGURATION/ class=md-nav__link> Jira configuration </a> </li> <li class=md-nav__item> <a href=../CROWD_CONFIGURATION/ class=md-nav__link> Crowd configuration </a> </li> <li class=md-nav__item> <a href=../DCAPT_CONFIGURATION/ class=md-nav__link> DCAPT Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../CLEANUP/ class=md-nav__link> Uninstallation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Troubleshooting data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../troubleshooting/TROUBLESHOOTING/ class=md-nav__link> Troubleshooting tips </a> </li> <li class=md-nav__item> <a href=../../../troubleshooting/SUPPORT_BOUNDARIES/ class=md-nav__link> Support boundaries </a> </li> <li class=md-nav__item> <a href=../../../troubleshooting/LIMITATIONS/ class=md-nav__link> Limitations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Development <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Development data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../development/HOW_TO_START/ class=md-nav__link> How to start development </a> </li> <li class=md-nav__item> <a href=../../../development/HOW_TO_TEST/ class=md-nav__link> Testing </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#common-configuration_1 class=md-nav__link> Common Configuration </a> <nav class=md-nav aria-label="Common Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environment-name class=md-nav__link> Environment Name </a> </li> <li class=md-nav__item> <a href=#eks-k8s-api-version class=md-nav__link> EKS K8S API version </a> </li> <li class=md-nav__item> <a href=#region class=md-nav__link> Region </a> </li> <li class=md-nav__item> <a href=#products class=md-nav__link> Products </a> </li> <li class=md-nav__item> <a href=#whitelist-ip-blocks class=md-nav__link> Whitelist IP blocks </a> </li> <li class=md-nav__item> <a href=#domain class=md-nav__link> Domain </a> </li> <li class=md-nav__item> <a href=#resource-tags class=md-nav__link> Resource tags </a> </li> <li class=md-nav__item> <a href=#eks-instance-type-and-storage-size class=md-nav__link> EKS instance type and storage size </a> </li> <li class=md-nav__item> <a href=#eks-node-launch-template class=md-nav__link> EKS Node Launch Template </a> </li> <li class=md-nav__item> <a href=#cluster-size class=md-nav__link> Cluster size </a> </li> <li class=md-nav__item> <a href=#additional-iam-roles class=md-nav__link> Additional IAM roles </a> </li> <li class=md-nav__item> <a href=#logging-s3-bucket-name class=md-nav__link> Logging S3 bucket name </a> </li> <li class=md-nav__item> <a href=#monitoring class=md-nav__link> Monitoring </a> </li> <li class=md-nav__item> <a href=#snapshot-configuration class=md-nav__link> Snapshot Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#product-specific-configuration class=md-nav__link> Product specific configuration </a> </li> <li class=md-nav__item> <a href=#sensitive-data class=md-nav__link> Sensitive Data </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/atlassian-labs/data-center-terraform/edit/main/docs/docs/userguide/configuration/CONFIGURATION.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=common-configuration>Common configuration<a class=headerlink href=#common-configuration title="Permanent link"> ¶</a></h1> <p>In order to provision the infrastructure and install an Atlassian Data Center product, you need to create a valid <a class=external href=https://www.terraform.io/language>Terraform configuration</a>. All configuration data should go to a Terraform configuration file.</p> <p>The content of the configuration file is divided into two groups:</p> <ol> <li><a href=#common-configuration>Common configuration</a></li> <li><a href=#product-specific-configuration>Product specific configuration</a></li> </ol> <div class="admonition info"> <p class=admonition-title>Configuration file format.</p> <p>The configuration file is an ASCII text file with the <code>.tfvars</code> extension. The config file must contain all mandatory configuration items with valid values. If any optional items are missing, the default values will be applied.</p> </div> <p>The <a href=#mandatory-configuration>mandatory configuration</a> items are those you should define once before the first installation. Mandatory values cannot be changed during the entire environment lifecycle.</p> <p>The <a href=#optional-configuration>optional configuration</a> items are not required for installation by default. Optional values may change at any point in the environment lifecycle. Terraform will retain the latest state of the environment and keep track of any configuration changes made later.</p> <p>The following is an example of a valid configuration file:</p> <div class=highlight><pre><span></span><code><span class=c1># Mandatory items</span>
<span class=na>environment_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my-bamboo-env&quot;</span>
<span class=na>region</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-east-2&quot;</span>

<span class=c1># Optional items</span>
<span class=nb>resource_tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>Terraform</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;true&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=na>Organization</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;atlassian&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=na>product</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;bamboo&quot;</span><span class=w> </span><span class=p>,</span>
<span class=p>}</span>

<span class=na>instance_types</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;m5.xlarge&quot;</span><span class=p>]</span>
<span class=na>desired_capacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span>
<span class=na>domain</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;mydomain.com&quot;</span>
</code></pre></div> <h2 id=common-configuration_1>Common Configuration<a class=headerlink href=#common-configuration_1 title="Permanent link"> ¶</a></h2> <p>Environmental properties common to all deployments.</p> <h3 id=environment-name>Environment Name<a class=headerlink href=#environment-name title="Permanent link"> ¶</a></h3> <p><code>environment_name</code> provides your environment a unique name within a single cloud provider account. This value cannot be altered after the configuration has been applied. The value will be used to form the name of some resources including <code>VPC</code> and <code>Kubernetes cluster</code>.</p> <div class=highlight><pre><span></span><code><span class=na>environment_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&lt;your-environment-name&gt;&quot; # e.g. &quot;my-terraform-env&quot;</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Format</p> <p>Environment names should start with a letter and can contain letters, numbers, and dashes (<code>-</code>). The maximum value length is 24 characters.</p> </div> <h3 id=eks-k8s-api-version>EKS K8S API version<a class=headerlink href=#eks-k8s-api-version title="Permanent link"> ¶</a></h3> <p><code>eks_version</code> is the supported EKS K8S API version. It must be a valid <a href=https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html>EKS version</a>.</p> <div class="admonition tip"> <p class=admonition-title>Latest EKS version</p> </div> <p>It is recommended to use the default value, however it is possible to override it to try a different (the latest) EKS version for experimental purposes.</p> <h3 id=region>Region<a class=headerlink href=#region title="Permanent link"> ¶</a></h3> <p><code>region</code> defines the cloud provider region that the environment will be deployed to.</p> <div class=highlight><pre><span></span><code><span class=na>region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&lt;REGION&gt;&quot;  # e.g. &quot;ap-northeast-2&quot;</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Format</p> <p>The value must be a valid <a class=external href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html>AWS region</a>.</p> </div> <h3 id=products>Products<a class=headerlink href=#products title="Permanent link"> ¶</a></h3> <p>The <code>products</code> list can be configured with one or multiple products. This will result in these products being deployed to the same K8s cluster. For example, if a Jira and Confluence deployment is required this property can be configured as follows:</p> <div class=highlight><pre><span></span><code><span class=na>products</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;jira&quot;, &quot;confluence&quot;</span><span class=p>]</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Available values</p> <p><code>jira</code>, <code>confluence</code>, <code>bitbucket</code>, <code>bamboo</code></p> </div> <h3 id=whitelist-ip-blocks>Whitelist IP blocks<a class=headerlink href=#whitelist-ip-blocks title="Permanent link"> ¶</a></h3> <p><code>whitelist_cidr</code> defines a set of CIDRs that are allowed to run the applications.</p> <p>By default, the deployed applications are publicly accessible. You can restrict this access by changing the default value to your desired CIDR blocks that are allowed to run the applications.</p> <div class=highlight><pre><span></span><code><span class=na>whitelist_cidr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;199.0.0.0/8&quot;, &quot;119.81.0.0/16&quot;</span><span class=p>]</span>
</code></pre></div> <h3 id=domain>Domain<a class=headerlink href=#domain title="Permanent link"> ¶</a></h3> <p>We recommend using a domain name to access the application via <code>HTTPS</code>. You will be required to secure a domain name and supply the configuration to the config file.</p> <p>When the domain is provided, Terraform will create a <a href=https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/Welcome.html>Route53</a> hosted zone based on the <code>environment</code> name.</p> <div class=highlight><pre><span></span><code><span class=na>domain</span><span class=o>=</span><span class=s2>&quot;&lt;DOMAIN_NAME&gt;&quot; # e.g. &quot;mydomain.com&quot;</span>
</code></pre></div> <p>A fully qualified domain name uses the following format: <code>&lt;product&gt;.&lt;environment-name&gt;.&lt;domain-name&gt;</code>. For example <code>bamboo.staging.mydomain.com</code>.</p> <div class="admonition tip"> <p class=admonition-title>Ingress controller</p> <p>If a domain name is defined, Terraform will create a <a href=https://kubernetes.github.io/ingress-nginx/ >nginx-ingress controller</a> in the EKS cluster that will provide access to the application via the domain name.</p> <p>Terraform will also create an <a href=https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html>ACM certificate</a> to provide secure connections over HTTPS.</p> </div> <div class="admonition info"> <p class=admonition-title>Provision the infrastructure without a domain</p> <p>When commented out the product will be exposed via an unsecured (<code>HTTP</code> only) DNS endpoint automatically provisioned as part of the AWS ELB load balancer, for example: <code>http://&lt;load-balancer-id&gt;.&lt;region&gt;.elb.amazonaws.com</code>. This DNS Name will be printed out as part of the outputs after the infrastructure has been provisioned.</p> </div> <h3 id=resource-tags>Resource tags<a class=headerlink href=#resource-tags title="Permanent link"> ¶</a></h3> <p><code>resource_tags</code> are custom metadata for all resources in the environment. You can provide multiple tags as a list.</p> <div class="admonition info"> <p class=admonition-title>Tag propagation</p> <p>Tag names must be unique, and tags will be propogated to all provisioned resources.</p> </div> <div class=highlight><pre><span></span><code><span class=nb>resource_tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=err>&lt;tag-name-</span><span class=m>0</span><span class=err>&gt;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s2>&quot;&lt;tag-value&gt;&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=err>&lt;tag-name-</span><span class=m>1</span><span class=err>&gt;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s2>&quot;&lt;tag-value&gt;&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=p>...</span>
<span class=w>  </span><span class=err>&lt;tag-name-n&gt;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s2>&quot;&lt;tag-value&gt;&quot;</span><span class=p>,</span>
<span class=p>}</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Using Terraform CLI to apply tags is not recommended and may lead to missing tags in some resources.</p> <p>To apply tags to all resources, follow the <a href=../../INSTALLATION/ >installation guide</a>.</p> </div> <h3 id=eks-instance-type-and-storage-size>EKS instance type and storage size<a class=headerlink href=#eks-instance-type-and-storage-size title="Permanent link"> ¶</a></h3> <p><code>instance_types</code> defines the instance type for the EKS cluster node group.</p> <div class=highlight><pre><span></span><code><span class=na>instance_types</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;m5.2xlarge&quot;</span><span class=p>]</span>
</code></pre></div> <p>The instance type must be a valid <a href=https://aws.amazon.com/ec2/instance-types/ class=external>AWS instance type</a>.</p> <p><code>instance_disk_size</code> defines the size of default storage attached to an instance.</p> <div class=highlight><pre><span></span><code><span class=na>instance_disk_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>50</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Instance type and disk size selection</p> <p>Both properties cannot be changed once the infrastructure has been provisioned.</p> </div> <h3 id=eks-node-launch-template>EKS Node Launch Template<a class=headerlink href=#eks-node-launch-template title="Permanent link"> ¶</a></h3> <p>When Terraform creates a node group for the EKS cluster, the default launch template is created behind the scenes. However, if you need to install any additional tooling/software in the worker node EC2 instances, you may provide your own template in <code>data-center-terraform/modules/AWS/eks/nodegroup_launch_template/templates</code>. This needs to be a file with <code>.tlp</code> extension. See: <a href=https://docs.aws.amazon.com/eks/latest/userguide/launch-templates.html#launch-template-user-data>Amazon EC2 user data</a>. Here's an example:</p> <p><div class=highlight><pre><span></span><code>MIME-Version: 1.0
Content-Type: multipart/mixed; boundary=&quot;==MYBOUNDARY==&quot;

--==MYBOUNDARY==
Content-Type: text/x-shellscript; charset=&quot;us-ascii&quot;

#!/bin/bash
echo &quot;Running custom user data script&quot;

--==MYBOUNDARY==--
</code></pre></div> Templates in <code>data-center-terraform/modules/AWS/eks/nodegroup_launch_template/templates</code> will be merged with the default launch template. If you need to use environment variables in your custom scripts, make sure you escape them with an additional dollar sign, otherwise <code>templatefile</code> function will complain about a missing env var:</p> <p><div class=highlight><pre><span></span><code>foo=&quot;bar&quot;
echo $${foo}
</code></pre></div> Environment variables passed to <code>templatefile</code> function are not configurable (defined in <code>data-center-terraform/modules/AWS/eks/nodegroup_launch_template/locals.tf</code>), thus it makes sense to generate template outside terraform and pull it before installing/upgrading.</p> <h3 id=cluster-size>Cluster size<a class=headerlink href=#cluster-size title="Permanent link"> ¶</a></h3> <p>EKS cluster creates an <a href=https://docs.aws.amazon.com/eks/latest/userguide/autoscaling.html>Autoscaling Group (ASG)</a> that has defined minimum and maximum capacity. You are able to set these values in the config file:</p> <ul> <li>Minimum values are <code>1</code> and maximum is <code>20</code>.</li> </ul> <div class=highlight><pre><span></span><code><span class=na>min_cluster_capacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>1</span><span class=c1>  # between 1 and 20</span>
<span class=na>max_cluster_capacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>5</span><span class=c1>  # between 1 and 20</span>
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Cluster size and cost</p> <p>In the installation process, <a href=https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler>cluster-autoscaler</a> is installed in the Kubernetes cluster. The number of nodes will be automatically adjusted depending on the workload resource requirements.</p> </div> <h3 id=additional-iam-roles>Additional IAM roles<a class=headerlink href=#additional-iam-roles title="Permanent link"> ¶</a></h3> <p>When the EKS cluster is created, only the entity that created the cluster can access and list resources inside the cluster. To enable access for additional roles, you can add them to the config file:</p> <div class=highlight><pre><span></span><code><span class=nb>eks_additional_roles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=nb>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>kubernetes_group</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[]</span>
<span class=w>    </span><span class=na>principal_arn</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;arn:aws:iam::121212121212:role/test-policy-role&quot;</span>
<span class=w>    </span><span class=nb>policy_associations</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nb>admin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=na>policy_arn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy&quot;</span>
<span class=w>        </span><span class=nb>access_scope</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=na>namespaces</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[]</span>
<span class=w>          </span><span class=na>type</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;cluster&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Access Entries in AWS EKS</p> <p>For additional information regarding adding access entries in EKS cluster, follow the official <a class=external href=https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html#creating-access-entries>AWS documentation</a>.</p> </div> <h3 id=logging-s3-bucket-name>Logging S3 bucket name<a class=headerlink href=#logging-s3-bucket-name title="Permanent link"> ¶</a></h3> <p>If you wish to log activities of terraform backend create S3 bucket and provide the name of the S3 bucket as follows. This will allow the terraform script to link your terraform backend to logging bucket.</p> <div class=highlight><pre><span></span><code><span class=na>logging_bucket</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>&lt;LOGGING_S</span><span class=m>3</span><span class=err>_BUCKET_NAME&gt;</span><span class=c1>  # default is null</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>S3 Logging bucket Creation</p> <p>Providing <code>logging_bucket</code> will not guarantee the creation of the S3 Bucket. You will need to create one as part of the prerequisites.</p> </div> <h3 id=monitoring>Monitoring<a class=headerlink href=#monitoring title="Permanent link"> ¶</a></h3> <p>If you want to deploy a monitoring stack to the cluster, use the following variable in config.tfvars file:</p> <div class=highlight><pre><span></span><code>monitoring_enabled = true
</code></pre></div> <p>When enabled, Terraform will deploy <a class=external href=https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack>kube-prometheus-stack</a> Helm chart with Prometheus, AlertManager, Node Exporter and Grafana.</p> <p>By default, Grafana service isn't exposed, and you can login to Grafana at <code>http://localhost:3000</code> after running:</p> <div class=highlight><pre><span></span><code>kubectl port-forward $grafana-pod 3000:3000 -n kube-monitoring
</code></pre></div> <p>If you want to expose Grafana service as <code>LoadBalancer</code>, set <code>monitoring_grafana_expose_lb</code> to <code>true</code>:</p> <div class=highlight><pre><span></span><code>monitoring_grafana_expose_lb = true
</code></pre></div> <p>Run the following command to get Grafana service hostname:</p> <div class=highlight><pre><span></span><code>kubectl get svc -n kube-monitoring
</code></pre></div> <p>Out of the box Grafana is shipped with default Kubernetes dashboards which you can use to monitor pods health. You can also create own custom configmaps labeled <code>grafana_dashboard=dc_monitoring</code>, and Grafana sidecar will automatically import them.</p> <p>By default, both Prometheus and Grafana claim 10Gi of persistent storage. You can override the default values by setting:</p> <div class=highlight><pre><span></span><code>prometheus_pvc_disk_size = &quot;50Gi&quot;
grafana_pvc_disk_size = &quot;20Gi&quot;
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Volume Expansion</p> <p>Out of the box EKS cluster is created with gp2 storage class which does not allow volume expansion, i.e. if you expect a high volume of metrics or metrics with high cardinality it is recommended to override the default Prometheus 10Gi PVC storage request when creating enabling monitoring for the first time. <a class=external href=https://docs.aws.amazon.com/eks/latest/userguide/storage-classes.html>AWS documentation</a>.</p> </div> <h3 id=snapshot-configuration>Snapshot Configuration<a class=headerlink href=#snapshot-configuration title="Permanent link"> ¶</a></h3> <p>It is possible to restore DC products from snapshots. Each DC product requires a valid public RDS and EBS (shared-home) snapshot defined by the following variables:</p> <div class=highlight><pre><span></span><code>&lt;product&gt;_db_snapshot_id
</code></pre></div> <div class=highlight><pre><span></span><code>&lt;product&gt;_shared_home_snapshot_id
</code></pre></div> <p>Note that COnfluence and Crowd also require a build number:</p> <div class=highlight><pre><span></span><code>confluence_db_snapshot_build_number = &quot;8017&quot;
crowd_db_snapshot_build_number = &quot;5023&quot;
</code></pre></div> <p>Snapshots must be public and exist in the target region.</p> <div class="admonition info"> <p class=admonition-title>Snapshots JSON File</p> <p>It is also possible to use a special snapshots JSON file with pre-defined snapshot ID and build numbers for all products for both small and large dataset sizes.</p> <p>You can find example JSON in <code>test/dcapt-snapshots.json</code>. To use snapshots JSON rather than dedicated environment variables, set in <code>config.tfvars</code>:</p> <div class=highlight><pre><span></span><code>snapshots_json_file_path = &quot;test/dcapt-snapshots.json&quot;
</code></pre></div> <p>If <code>snapshots_json_file_path</code> snapshot variables defined in <code>config.tfvars</code> are ignored.</p> <p>Only use snapshots JSON suggested by <a class=external href=https://github.com/atlassian/dc-app-performance-toolkit>DCAPT team</a>. </p> </div> <h2 id=product-specific-configuration>Product specific configuration<a class=headerlink href=#product-specific-configuration title="Permanent link"> ¶</a></h2> <div class="tabbed-set tabbed-alternate" data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Bamboo</label><label for=__tabbed_1_2>Confluence</label><label for=__tabbed_1_3>Jira</label></div> <div class=tabbed-content> <div class=tabbed-block> <p><a href=../BAMBOO_CONFIGURATION/ >Bamboo specific configuration</a></p> </div> <div class=tabbed-block> <p><a href=../CONFLUENCE_CONFIGURATION/ >Confluence specific configuration</a></p> </div> <div class=tabbed-block> <p><a href=../JIRA_CONFIGURATION/ >Jira specific configuration</a></p> </div> </div> </div> <h2 id=sensitive-data>Sensitive Data<a class=headerlink href=#sensitive-data title="Permanent link"> ¶</a></h2> <p>Sensitive input data will eventually be stored as <a href=https://kubernetes.io/docs/concepts/configuration/secret/#security-properties>secrets within Kubernetes cluster</a>.</p> <p>We use <code>config.tfvars</code> file to pass configuration values to Terraform stack. The file itself is plain-text on local machine, and will not be stored in remote backend where all the Terraform state files will be stored encrypted. More info regarding sensitive data in Terraform state can be found <a href=https://www.terraform.io/docs/language/state/sensitive-data.html>here</a>.</p> <p>To avoid storing sensitive data in a plain-text file like <code>config.tfvars</code>, we recommend storing them in environment variables prefixed with <a href=https://www.terraform.io/docs/cli/config/environment-variables.html#tf_var_name><code>TF_VAR_</code></a>.</p> <p>Take<code>bamboo_admin_password</code> for example, for Linux-like sytems, run the following command to write bamboo admin password to environment variable:</p> <div class=highlight><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>TF_VAR_bamboo_admin_password</span><span class=o>=</span>&lt;password&gt;
</code></pre></div> <p>If storing this data as plain-text is not a particular concern for the environment to be deployed, you can also choose to supply the values in <code>config.tfvars</code> file. Uncomment the corresponding line and configure the value there.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../INSTALLATION/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Installation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Installation </div> </div> </a> <a href=../BAMBOO_CONFIGURATION/ class="md-footer__link md-footer__link--next" aria-label="Next: Bamboo configuration" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Bamboo configuration </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; [2021] to [2022] Atlassian and others. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes target=_blank rel=noopener title=community.atlassian.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M152.2 236.4c-7.7-8.2-19.7-7.7-24.8 2.8L1.6 490.2c-5 10 2.4 21.7 13.4 21.7h175c5.8.1 11-3.2 13.4-8.4 37.9-77.8 15.1-196.3-51.2-267.1zM244.4 8.1c-122.3 193.4-8.5 348.6 65 495.5 2.5 5.1 7.7 8.4 13.4 8.4H497c11.2 0 18.4-11.8 13.4-21.7 0 0-234.5-470.6-240.4-482.3-5.3-10.6-18.8-10.8-25.6.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.instant", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.3a4b43e5.min.js></script> </body> </html>